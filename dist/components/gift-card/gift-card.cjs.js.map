{"version":3,"file":"gift-card.cjs.js","sources":["../../../src/components/gift-card/gift-card.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { LoadingCard, PayButton } from './gift-card.styles';\nimport type {\n  GiftCardBase,\n  GiftCardFunctionChildren,\n  GiftCardPayButtonProps,\n  GiftCardProps,\n  GiftCardWithChildren,\n} from './gift-card.types';\n\n/**\n * Renders a Gift Card Input to use in the Square Web Payment SDK, pre-styled to\n * meet Square branding guidelines.\n *\n * **_But with the option to override styles_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <GiftCard />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nfunction GiftCard(props: GiftCardBase): JSX.Element;\nfunction GiftCard(props: GiftCardFunctionChildren): JSX.Element;\nfunction GiftCard(props: GiftCardWithChildren): JSX.Element;\nfunction GiftCard({\n  buttonProps = {\n    id: 'rswps-gift-card-button',\n  },\n  callbacks,\n  children,\n  focus,\n  id = 'rswps-gift-card-container',\n  includeInputLabels,\n  render,\n  style,\n  ...props\n}: GiftCardProps) {\n  const [giftCard, setGiftCard] = React.useState<Square.GiftCard | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const { cardTokenizeResponseReceived, payments } = useForm();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n\n  const options: Square.GiftCardOptions = React.useMemo(() => {\n    const baseOptions = {\n      includeInputLabels,\n      style,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [includeInputLabels, style]);\n\n  /** Tokenizes a GiftCard payment method instance. */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!giftCard) {\n      console.warn('Gift Card button was clicked, but no Gift Card instance was found.');\n\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const result = await giftCard?.tokenize();\n\n      if (result.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const giftCard = await payments?.giftCard(options).then((res) => {\n        if (!signal.aborted) {\n          setGiftCard(res);\n\n          return res;\n        }\n\n        return null;\n      });\n\n      await giftCard?.attach(`#${id}`);\n      if (focus) {\n        await giftCard?.focus(focus);\n      }\n\n      if (signal.aborted) {\n        await giftCard?.destroy();\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [payments, id]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      giftCard?.addEventListener(\n        callback as Square.GiftCardInputEventTypes,\n        (callbacks as Record<string, (event: Square.SqEvent<Square.GiftCardInputEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const Button = ({ isLoading, ...props }: GiftCardPayButtonProps) => {\n    const id = 'rswp-gift-card-button';\n    const disabled = isLoading || !giftCard || isSubmitting;\n\n    return (\n      <PayButton\n        {...props}\n        aria-disabled={disabled}\n        css={props?.css}\n        disabled={disabled}\n        id={id}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {props?.children ?? 'Pay with Gift Card'}\n      </PayButton>\n    );\n  };\n\n  return (\n    <>\n      <div {...props} data-testid=\"rswps-gift-card-container\" id={id} style={{ minHeight: 89 }}>\n        {!giftCard && <LoadingCard />}\n      </div>\n\n      {typeof render === 'function' ? (\n        render(Button)\n      ) : (\n        <Button {...buttonProps}>{children ?? 'Pay with Gift Card'}</Button>\n      )}\n    </>\n  );\n}\n\nexport default GiftCard;\nexport * from './gift-card.types';\n"],"names":["GiftCard","buttonProps","callbacks","children","focus","id","includeInputLabels","render","style","props","giftCard","setGiftCard","React","isSubmitting","setIsSubmitting","cardTokenizeResponseReceived","payments","useForm","buttonRef","options","baseOptions","acc","key","handlePayment","result","message","error","abortController","signal","res","callback","useEventListener","Button","isLoading","disabled","PayButton","LoadingCard"],"mappings":"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"}