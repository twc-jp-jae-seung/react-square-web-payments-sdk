"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const P=require("react"),R=require("../../contexts/form/form.cjs.js"),_=require("../../hooks/use-event-listener.cjs.js"),C=require("./gift-card.styles.cjs.js");function z(n){if(n&&n.__esModule)return n;const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const a in n)if(a!=="default"){const c=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(o,a,c.get?c:{enumerable:!0,get:()=>n[a]})}}return o.default=n,Object.freeze(o)}const r=z(P);function G({buttonProps:n={id:"rswps-gift-card-button"},callbacks:o,children:a,focus:c,id:f="rswps-gift-card-container",includeInputLabels:l,render:b,style:g,...v}){const[u,h]=r.useState(()=>{}),[O,m]=r.useState(!1),{cardTokenizeResponseReceived:E,payments:w}=R.useForm(),y=r.useRef(null),S=r.useMemo(()=>{const e={includeInputLabels:l,style:g};return Object.keys(e).reduce((t,s)=>(e[s]!==void 0&&(t[s]=e[s]),t),{})},[l,g]),k=async e=>{if(e.stopPropagation(),!u){console.warn("Gift Card button was clicked, but no Gift Card instance was found.");return}m(!0);try{const t=await u?.tokenize();if(t.status==="OK")return await E(t);let s=`Tokenization failed with status: ${t.status}`;if(t?.errors)throw s+=` and errors: ${JSON.stringify(t?.errors)}`,new Error(s);console.warn(s)}catch(t){console.error(t)}finally{m(!1)}};if(r.useEffect(()=>{const e=new AbortController,{signal:t}=e;return(async i=>{const d=await w?.giftCard(S).then(j=>i.aborted?null:(h(j),j));await d?.attach(`#${f}`),c&&await d?.focus(c),i.aborted&&await d?.destroy()})(t),()=>{e.abort()}},[w,f]),o)for(const e of Object.keys(o))u?.addEventListener(e,o[e]);_.useEventListener({listener:k,type:"click",element:y,options:{passive:!0}});const p=({isLoading:e,...t})=>{const s="rswp-gift-card-button",i=e||!u||O;return r.createElement(C.PayButton,{...t,"aria-disabled":i,css:t?.css,disabled:i,id:s,ref:y,type:"button"},t?.children??"Pay with Gift Card")};return r.createElement(r.Fragment,null,r.createElement("div",{...v,"data-testid":"rswps-gift-card-container",id:f,style:{minHeight:89}},!u&&r.createElement(C.LoadingCard,null)),typeof b=="function"?b(p):r.createElement(p,{...n},a??"Pay with Gift Card"))}exports.default=G;
//# sourceMappingURL=gift-card.cjs.js.map
