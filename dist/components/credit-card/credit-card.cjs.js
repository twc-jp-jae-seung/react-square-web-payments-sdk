"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const P=require("react"),z=require("../../contexts/form/form.cjs.js"),M=require("../../hooks/use-event-listener.cjs.js"),O=require("./credit-card.styles.cjs.js");function q(n){if(n&&n.__esModule)return n;const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const c in n)if(c!=="default"){const a=Object.getOwnPropertyDescriptor(n,c);Object.defineProperty(i,c,a.get?a:{enumerable:!0,get:()=>n[c]})}}return i.default=n,Object.freeze(i)}const r=q(P);function L({buttonProps:n,callbacks:i,children:c,focus:a,id:l="rswps-card-container",includeInputLabels:f,postalCode:m,recalculateSize:b,render:y,style:w,...C}){const[o,h]=r.useState(()=>{}),[S,g]=r.useState(!1),p=r.useRef(null),{cardTokenizeResponseReceived:k,payments:j}=z.useForm(),R=r.useMemo(()=>{const t={includeInputLabels:f,postalCode:m,style:w};return Object.keys(t).reduce((e,s)=>(t[s]!==void 0&&(e[s]=t[s]),e),{})},[f,m,w]),_=async t=>{if(t.stopPropagation(),!n?.isLoading){if(!o){console.warn("Credit Card button was clicked, but no Credit Card instance was found.");return}g(!0);try{const e=await o.tokenize();if(e.status==="OK")return await k(e);let s=`Tokenization failed with status: ${e.status}`;if(e?.errors)throw s+=` and errors: ${JSON.stringify(e?.errors)}`,new Error(s);console.warn(s)}catch(e){console.error(e)}finally{g(!1)}}};if(r.useEffect(()=>{const t=new AbortController,{signal:e}=t;return(async d=>{const u=await j?.card(R).then(E=>d.aborted?null:(h(E),E));await u?.attach(`#${l}`),a&&await u?.focus(a),d.aborted&&await u?.destroy()})(e),()=>{t.abort()}},[j,l]),r.useEffect(()=>{o&&a&&o.focus(a)},[o,a]),i)for(const t of Object.keys(i))o?.addEventListener(t,i[t]);b&&b(o?.recalculateSize),M.useEventListener({listener:_,type:"click",element:p,options:{passive:!0}});const v=({children:t,isLoading:e,...s})=>{const d="rswp-card-button",u=e||!o||S;return r.createElement(O.PayButton,{...s,"aria-disabled":u,css:s?.css,disabled:u,id:d,ref:p,type:"button"},t??"Pay")};return r.createElement(r.Fragment,null,r.createElement("div",{...C,"data-testid":"rswps-card-container",id:l,style:{minHeight:89}},!o&&r.createElement(O.LoadingCard,null)),typeof y=="function"?y(v):r.createElement(v,{...n},c??"Pay"))}exports.default=L;
//# sourceMappingURL=credit-card.cjs.js.map
