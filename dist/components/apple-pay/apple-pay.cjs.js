"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const b=require("react"),P=require("../../contexts/form/form.cjs.js"),g=require("../../hooks/use-event-listener.cjs.js"),h=require("./apple-pay.styles.cjs.js");function v(t){if(t&&t.__esModule)return t;const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const e in t)if(e!=="default"){const s=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,s.get?s:{enumerable:!0,get:()=>t[e]})}}return n.default=t,Object.freeze(n)}const i=v(b);function j({id:t="rswps-apple-pay",...n}){const[e,s]=i.useState(()=>{}),{cardTokenizeResponseReceived:w,createPaymentRequest:c,payments:l}=P.useForm(),p=i.useRef(null),m=async o=>{if(o.stopPropagation(),!e){console.warn("Apple Pay button was clicked, but no Apple Pay instance was found.");return}try{const r=await e.tokenize();if(r.status==="OK")return w(r);let a=`Tokenization failed with status: ${r.status}`;if(r?.errors)throw a+=` and errors: ${JSON.stringify(r?.errors)}`,new Error(a);console.warn(a)}catch(r){console.error(r)}};return i.useEffect(()=>{if(!c)throw new Error("`createPaymentRequest()` is required when using digital wallets");const o=new AbortController,{signal:r}=o;return(async y=>{const f=l?.paymentRequest(c);if(!f)throw new Error("`paymentRequest` is required when using digital wallets");try{const u=await l?.applePay(f).then(d=>{if(!y?.aborted)return s(d),d});y.aborted&&await u?.destroy()}catch(u){console.error("Initializing Apple Pay failed",u)}})(r),()=>{o.abort()}},[c,l]),g.useEventListener({listener:m,type:"click",element:p,options:{passive:!0}}),i.createElement(h.ApplePayContainer,{...n,css:{display:e?"block":"none",opacity:e?1:.5,pointerEvents:e?"auto":"none",visibility:e?"visible":"hidden"},id:t,ref:p})}exports.default=j;
//# sourceMappingURL=apple-pay.cjs.js.map
