{"version":3,"file":"cash-app-pay.cjs.js","sources":["../../../src/components/cash-app-pay/cash-app-pay.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport type { CashAppPayProps } from './cash-app-pay.types';\n\nfunction CashAppPay({\n  callbacks,\n  id = 'rswps-cash-app-pay',\n  redirectURL,\n  referenceId,\n  shape = 'round',\n  size = 'medium',\n  values = 'dark',\n  width = 'static',\n  ...props\n}: CashAppPayProps) {\n  const [cashApp, setCashApp] = React.useState<Square.CashAppPay>();\n  const { createPaymentRequest, payments } = useForm();\n\n  const paymentRequestOptions: Square.CashAppPaymentRequestOptions = React.useMemo(\n    () => ({\n      redirectURL: redirectURL || window.location.href,\n      referenceId,\n    }),\n    [redirectURL, referenceId]\n  );\n\n  const options: Square.CashAppPayButtonOptions = React.useMemo(() => {\n    const baseOptions = {\n      shape,\n      size,\n      values,\n      width,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [shape, size, values, width]);\n\n  React.useEffect(() => {\n    if (!createPaymentRequest) {\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\n    }\n\n    const abortController = new AbortController();\n    const { signal } = abortController;\n    let cashApp: Square.CashAppPay | undefined;\n\n    const start = async (signal: AbortSignal) => {\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\n\n      if (!paymentRequest) {\n        throw new Error('`paymentRequest` is required when using digital wallets');\n      }\n\n      try {\n        cashApp = await payments?.cashAppPay(paymentRequest, paymentRequestOptions).then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setCashApp(res);\n\n          return res;\n        });\n\n        await cashApp?.attach(`#${id}`, options);\n      } catch (error) {\n        console.error('Initializing Cash App Pay failed', error);\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n      cashApp?.destroy();\n    };\n  }, [createPaymentRequest, options, paymentRequestOptions, payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      cashApp?.addEventListener(\n        callback.toLowerCase() as 'ontokenization',\n        (callbacks as Record<string, (event: Square.SqEvent<Square.TokenizationEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  return <div {...props} id={id} />;\n}\n\nexport default CashAppPay;\nexport * from './cash-app-pay.types';\n"],"names":["CashAppPay","callbacks","id","redirectURL","referenceId","shape","size","values","width","props","cashApp","setCashApp","React","createPaymentRequest","payments","useForm","paymentRequestOptions","options","baseOptions","acc","key","abortController","signal","paymentRequest","res","error","callback"],"mappings":"weAQA,SAASA,EAAW,CAClB,UAAAC,EACA,GAAAC,EAAK,qBACL,YAAAC,EACA,YAAAC,EACA,MAAAC,EAAQ,QACR,KAAAC,EAAO,SACP,OAAAC,EAAS,OACT,MAAAC,EAAQ,YACLC,CACL,EAAoB,CAClB,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAM,SAA4B,EAC1D,CAAE,qBAAAC,EAAsB,SAAAC,CAAS,EAAIC,EAAQ,QAAA,EAE7CC,EAA6DJ,EAAM,QACvE,KAAO,CACL,YAAaT,GAAe,OAAO,SAAS,KAC5C,YAAAC,CAAA,GAEF,CAACD,EAAaC,CAAW,CAAA,EAGrBa,EAA0CL,EAAM,QAAQ,IAAM,CAClE,MAAMM,EAAc,CAClB,MAAAb,EACA,KAAAC,EACA,OAAAC,EACA,MAAAC,CAAA,EAIF,OAAO,OAAO,KAAKU,CAAW,EAAE,OAAO,CAACC,EAA8BC,KAChEF,EAAYE,KAAqC,SACnDD,EAAIC,GAAiBF,EAAYE,IAG5BD,GACN,CAAE,CAAA,GACJ,CAACd,EAAOC,EAAMC,EAAQC,CAAK,CAAC,EA2C/B,GAzCAI,EAAM,UAAU,IAAM,CACpB,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,iEAAiE,EAG7E,MAAAQ,EAAkB,IAAI,gBACtB,CAAE,OAAAC,CAAW,EAAAD,EACfX,IAAAA,EA0BJ,OAxBc,MAAOY,GAAwB,CACrC,MAAAC,EAAiBT,GAAU,eAAeD,CAAoB,EAEpE,GAAI,CAACU,EACG,MAAA,IAAI,MAAM,yDAAyD,EAGvE,GAAA,CACFb,EAAU,MAAMI,GAAU,WAAWS,EAAgBP,CAAqB,EAAE,KAAMQ,GAAQ,CACxF,GAAIF,CAAAA,GAAQ,QAIZ,OAAAX,EAAWa,CAAG,EAEPA,CAAA,CACR,EAED,MAAMd,GAAS,OAAO,IAAIR,IAAMe,CAAO,QAChCQ,GACC,QAAA,MAAM,mCAAoCA,CAAK,CACzD,CAAA,GAGIH,CAAM,EAEL,IAAM,CACXD,EAAgB,MAAM,EACtBX,GAAS,QAAQ,CAAA,GAElB,CAACG,EAAsBI,EAASD,EAAuBF,CAAQ,CAAC,EAE/Db,EACF,UAAWyB,KAAY,OAAO,KAAKzB,CAAS,EACjCS,GAAA,iBACPgB,EAAS,YAAY,EACpBzB,EAAwFyB,EAAA,EAK/F,OAAQd,EAAA,cAAA,MAAA,CAAK,GAAGH,EAAO,GAAAP,CAAQ,CAAA,CACjC"}